{"version":3,"file":"index.js","sources":["../../src/utils.ts","../../src/action.ts","../../src/action-func.ts","../../src/action-sleep.ts","../../src/run-one.ts","../../src/run-all.ts","../../src/run-queue.ts","../../src/run-step.ts"],"sourcesContent":["import { Action } from './action';\n\nexport interface IContext {\n\tlogger?: (level: string, msg: any, action?: Action) => void;\n\tdatas?: { [name: string]: any };\n\terrs?: Error[];\n\t[name: string]: any;\n}\n\nexport const isError = (e: any) => Object.prototype.toString.call(e) === '[object Error]' || e instanceof Error;\n\nexport type IWatcher = (action?: Action, context?: any, data?: any, err?: Error) => any;\n\nexport interface IDeferer {\n\tp?: Promise<any>;\n\tresolve?: any;\n\treject?: any;\n}\nexport const defer = (): IDeferer => {\n\tconst d: IDeferer = {} as any;\n\td.p = new Promise((resolve, reject) => {\n\t\td.resolve = resolve;\n\t\td.reject = reject;\n\t});\n\treturn d;\n};\n\nexport const ActionStatus = {\n\tIdle: 0,\n\tPending: 1,\n\tResolved: 2,\n\tRejected: 3,\n\tStopped: 4,\n};\nexport const ErrHandler = {\n\tIgnore: 0,\n\tRejectImmediately: 1,\n\tRejectAllDone: 2,\n};\n","import { ActionStatus, defer, ErrHandler, IDeferer, isError, IWatcher } from './utils';\n\nexport class Action {\n\tprotected parent: Action;\n\tprotected context: any;\n\tprotected name: string;\n\tprotected status: number = ActionStatus.Idle;\n\tprotected data: any;\n\tprotected error: Error;\n\tprotected watchers: IWatcher[];\n\t//utils\n\tprotected rp: IDeferer;\n\n\tpublic setContext(context: any) {\n\t\tthis.context = context;\n\t\treturn this;\n\t}\n\tpublic getContext() {\n\t\treturn this.context;\n\t}\n\tpublic setName(name: string) {\n\t\tthis.name = name;\n\t\treturn this;\n\t}\n\tpublic getName(): string {\n\t\treturn this.name;\n\t}\n\tpublic getFullName(ln: string = '/', showAll: boolean = false): string {\n\t\tlet name = this.name || (showAll ? '..' : '');\n\t\tif (this.parent) {\n\t\t\tlet pn = this.parent.getFullName(ln, showAll);\n\t\t\tif (pn) {\n\t\t\t\treturn !name ? pn : `${pn}${ln}${name}`;\n\t\t\t}\n\t\t}\n\t\treturn name;\n\t}\n\tpublic getData() {\n\t\treturn this.data;\n\t}\n\tpublic getError() {\n\t\treturn this.error;\n\t}\n\t//状态\n\tpublic isIdle() {\n\t\treturn this.status === ActionStatus.Idle;\n\t}\n\tpublic isPending() {\n\t\treturn this.status === ActionStatus.Pending;\n\t}\n\tpublic isResolved() {\n\t\treturn this.status === ActionStatus.Resolved;\n\t}\n\tpublic isRejected() {\n\t\treturn this.status === ActionStatus.Rejected;\n\t}\n\tpublic isStopped() {\n\t\treturn this.status === ActionStatus.Stopped;\n\t}\n\t//watcher\n\tpublic watch(w: IWatcher, index = -1) {\n\t\tlet ws = this.watchers || (this.watchers = []);\n\t\tif (index < 0) ws.push(w);\n\t\telse if (!ws[index]) ws[index] = w;\n\t\telse {\n\t\t\tws.splice(index, 0, w);\n\t\t}\n\t\treturn this;\n\t}\n\t//\n\tprotected getRP() {\n\t\treturn this.rp || (this.rp = defer());\n\t}\n\tprotected endRP(resolve: boolean = true, data?: any) {\n\t\tif (this.rp) {\n\t\t\tresolve ? this.rp.resolve(data) : this.rp.reject(data || new Error('end runtime promise'));\n\t\t}\n\t}\n\tprotected logData() {\n\t\tif (this.data && this.context && this.name) {\n\t\t\t(this.context.datas || (this.context.datas = {}))[this.name] = this.data;\n\t\t}\n\t}\n\tprotected logErr() {\n\t\tif (this.context && (!this.context.errs || this.context.errs.indexOf(this.error) < 0)) {\n\t\t\t(this.context.errs || (this.context.errs = [])).push(this.error);\n\t\t\tif (this.context.logger) this.context.logger('error', this.error, this);\n\t\t}\n\t}\n\tprotected dispatch() {\n\t\tif (!this.watchers) return;\n\t\t//\n\t\tfor (let w of this.watchers) {\n\t\t\tif (w) w(this, this.context, this.data, this.error);\n\t\t}\n\t\tthis.watchers.length = 0;\n\t}\n\n\t//执行\n\tpublic async start(context?: any) {\n\t\tif (this.isIdle()) {\n\t\t\tlet data: any;\n\t\t\ttry {\n\t\t\t\tthis.context = this.context || context;\n\t\t\t\tthis.status = ActionStatus.Pending;\n\t\t\t\tdata = await this.doStart(this.context);\n\t\t\t\t//如果返回了另外一个Action\n\t\t\t\tif (data instanceof Action) {\n\t\t\t\t\tlet a = data as Action;\n\t\t\t\t\tdata = a.isResolved() ? a.getData() : a.getError() || new Error('unknown');\n\t\t\t\t}\n\t\t\t} catch (err) {\n\t\t\t\tdata = err;\n\t\t\t}\n\t\t\t//console.log('then', this.name, this.isPending(), data);\n\t\t\tif (this.isPending()) {\n\t\t\t\tif (!isError(data)) {\n\t\t\t\t\tthis.data = data;\n\t\t\t\t\tthis.status = ActionStatus.Resolved;\n\t\t\t\t\tthis.logData();\n\t\t\t\t} else {\n\t\t\t\t\tthis.error = data;\n\t\t\t\t\tthis.status = ActionStatus.Rejected;\n\t\t\t\t\tthis.logErr();\n\t\t\t\t}\n\t\t\t\tawait this.doStop(this.context);\n\t\t\t\tif (this.rp) this.endRP(true);\n\t\t\t\tthis.dispatch();\n\t\t\t}\n\t\t}\n\t\treturn this;\n\t}\n\tprotected async doStart(context: any) {\n\t\treturn null as any;\n\t}\n\tpublic async stop(context?: any) {\n\t\tif (this.isIdle() || this.isPending()) {\n\t\t\tlet isPending = this.isPending();\n\t\t\tthis.status = ActionStatus.Stopped;\n\t\t\tif (isPending) {\n\t\t\t\tthis.context = this.context || context;\n\t\t\t\tawait this.doStop(this.context);\n\t\t\t\tif (this.rp) this.endRP(true);\n\t\t\t}\n\t\t\tthis.dispatch();\n\t\t}\n\t\treturn this;\n\t}\n\tprotected async doStop(context: any) {\n\t\treturn null as any;\n\t}\n}\n\nexport class CompositeAction extends Action {\n\tprotected children: Action[] = [];\n\tprotected errHandler: number = ErrHandler.Ignore;\n\n\tconstructor(errHandler: number = ErrHandler.Ignore) {\n\t\tsuper();\n\t\tthis.errHandler = errHandler;\n\t}\n\tpublic setErrHandler(errHandler: number) {\n\t\tthis.errHandler = errHandler;\n\t\treturn this;\n\t}\n\t//层级结构\n\tpublic addChild(a: Action) {\n\t\tthis.children.push(a);\n\t\t(a as any).parent = this;\n\t\treturn this;\n\t}\n\tpublic addChildren(as: Action[]) {\n\t\tfor (let a of as) {\n\t\t\tthis.children.push(a);\n\t\t\t(a as any).parent = this;\n\t\t}\n\t\treturn this;\n\t}\n\tpublic numChildren() {\n\t\treturn this.children.length;\n\t}\n\n\tprotected async doStop(context: any) {\n\t\tif (this.children.length > 0) {\n\t\t\tlet all = [];\n\t\t\tfor (const a of this.children) all.push(a.stop(context));\n\t\t\tawait Promise.all(all);\n\t\t}\n\t\tthis.children.length = 0;\n\t}\n}\n","import { Action } from './action';\n\nexport type IFunc = (context: any, caller?: ActionForFunc) => Promise<any>;\n\nexport class ActionForFunc extends Action {\n\tprivate iDoStart: IFunc;\n\tprivate iDoStop?: IFunc;\n\n\tconstructor(doStart?: IFunc, doStop?: IFunc) {\n\t\tsuper();\n\t\tthis.iDoStart = doStart;\n\t\tthis.iDoStop = doStop;\n\t}\n\tpublic setDoStart(f: IFunc) {\n\t\tthis.iDoStart = f;\n\t\treturn this;\n\t}\n\tpublic setDoStop(f: IFunc) {\n\t\tthis.iDoStop = f;\n\t\treturn this;\n\t}\n\n\tprotected async doStart(context: any) {\n\t\treturn this.iDoStart(context, this);\n\t}\n\n\tprotected async doStop(context: any) {\n\t\tif (this.iDoStop) return this.iDoStop(context, this);\n\t}\n}\n","import { Action } from './action';\n\nexport class ActionForSleep extends Action {\n\tprivate timeout: number;\n\tprivate timer: any;\n\n\tconstructor(timeout: number) {\n\t\tsuper();\n\t\tthis.timeout = timeout;\n\t}\n\n\tprotected async doStart() {\n\t\tlet rp = this.getRP();\n\t\tthis.timer = setTimeout(rp.resolve, this.timeout);\n\t\tawait rp.p;\n\t}\n\n\tprotected async doStop() {\n\t\tif (this.timer) clearTimeout(this.timer);\n\t\tthis.timer = undefined;\n\t}\n}\n","import { CompositeAction } from './action';\nimport { ErrHandler } from './utils';\n\nexport class RunOne extends CompositeAction {\n\tconstructor(errHandler: number) {\n\t\tsuper(errHandler);\n\t}\n\n\tprotected async doStart(context: any) {\n\t\tlet e: Error;\n\t\twhile (this.children.length > 0) {\n\t\t\tlet action = this.children.shift();\n\t\t\tawait action.start(context);\n\t\t\tif (this.isPending() && action.isRejected()) {\n\t\t\t\tif (this.errHandler === ErrHandler.RejectImmediately) throw action.getError();\n\t\t\t\telse if (!e) {\n\t\t\t\t\te = action.getError();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t//\n\t\tif (e && this.errHandler === ErrHandler.RejectAllDone) throw e;\n\t}\n}\n","import { Action, CompositeAction } from './action';\nimport { ErrHandler } from './utils';\n\nexport class RunAll extends CompositeAction {\n\tconstructor(errHandler: number) {\n\t\tsuper(errHandler);\n\t}\n\n\tprotected async doStart(context: any) {\n\t\tif (this.children.length <= 0) return;\n\t\t//\n\t\tlet total = this.children.length;\n\t\tlet count = 0;\n\t\tlet w: any;\n\t\tlet e: Error;\n\t\tfor (const action of this.children) {\n\t\t\taction.start(context).then(\n\t\t\t\tw ||\n\t\t\t\t\t(w = (action: Action) => {\n\t\t\t\t\t\tif (!this.isPending()) return this.getRP().reject();\n\t\t\t\t\t\t//\n\t\t\t\t\t\tcount++;\n\t\t\t\t\t\tif (action.isRejected()) {\n\t\t\t\t\t\t\tif (!e) e = action.getError();\n\t\t\t\t\t\t\tif (this.errHandler === ErrHandler.RejectImmediately) return this.getRP().reject(e);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (count >= total) {\n\t\t\t\t\t\t\tif (e && this.errHandler === ErrHandler.RejectAllDone) this.getRP().reject(e);\n\t\t\t\t\t\t\telse this.getRP().resolve();\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t);\n\t\t}\n\t\t//\n\t\tawait this.getRP().p;\n\t}\n}\n","import { Action, CompositeAction } from './action';\nimport { ErrHandler } from './utils';\n\nexport class RunQueue extends CompositeAction {\n\tpublic static StopHandlerManual = 0;\n\tpublic static StopHandlerAuto = 1;\n\tpublic static StopHandlerAutoAtLeastOnce = 2;\n\n\tprotected stopHandler = RunQueue.StopHandlerAuto;\n\tprotected runCount = 5;\n\tprotected running: Action[] = [];\n\tprotected w: any;\n\tprotected e: Error;\n\tprotected toStop = false;\n\n\tconstructor(runCount: number = 5, stopHandler: number = RunQueue.StopHandlerAuto, errHandler: number = ErrHandler.RejectAllDone) {\n\t\tsuper(errHandler);\n\t\tthis.runCount = runCount;\n\t\tthis.stopHandler = stopHandler;\n\t}\n\tpublic setRunCount(runCount: number) {\n\t\tthis.runCount = runCount;\n\t\treturn this;\n\t}\n\tpublic setStopHandler(stopHandler: number) {\n\t\tthis.stopHandler = stopHandler;\n\t\treturn this;\n\t}\n\tpublic setToStop() {\n\t\tthis.toStop = true;\n\t\t//查看是否可以立即结束\n\t\tif (this.isIdle()) {\n\t\t\tthis.stop();\n\t\t} else if (this.isPending() && this.children.length === 0 && this.running.length === 0) {\n\t\t\tthis.done();\n\t\t}\n\t}\n\t//\n\tpublic addChild(a: Action) {\n\t\tif ((this.isIdle() || this.isPending()) && !this.toStop) {\n\t\t\tsuper.addChild(a);\n\t\t\tif (this.isPending()) this.next();\n\t\t}\n\t\treturn this;\n\t}\n\tpublic numChildren() {\n\t\treturn this.children.length + this.running.length;\n\t}\n\t//\n\tprotected async doStart(context: any) {\n\t\t//如果自动停止\n\t\tif (this.stopHandler === RunQueue.StopHandlerAuto && this.children.length <= 0) return;\n\t\tif (this.children.length > 0) this.next();\n\t\tawait this.getRP().p;\n\t}\n\tprivate next() {\n\t\tif (!this.isPending()) return this.getRP().reject();\n\t\t//\n\t\twhile (this.children.length > 0 && (this.runCount <= 0 || this.running.length < this.runCount)) {\n\t\t\tconst action = this.children.shift();\n\t\t\tif (!action.isIdle()) continue;\n\t\t\tthis.running.push(action);\n\t\t\taction.start(this.context).then(\n\t\t\t\tthis.w ||\n\t\t\t\t\t(this.w = (action: Action) => {\n\t\t\t\t\t\tif (!this.isPending()) return this.getRP().reject();\n\t\t\t\t\t\t//\n\t\t\t\t\t\tlet index = this.running.indexOf(action);\n\t\t\t\t\t\tif (index >= 0) {\n\t\t\t\t\t\t\tthis.running.splice(index, 1);\n\t\t\t\t\t\t\tif (action.isRejected()) {\n\t\t\t\t\t\t\t\tif (!this.e) this.e = action.getError();\n\t\t\t\t\t\t\t\tif (this.errHandler === ErrHandler.RejectImmediately) return this.getRP().reject(this.e);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\t//\n\t\t\t\t\t\tthis.next();\n\t\t\t\t\t})\n\t\t\t);\n\t\t}\n\t\t//\n\t\tif (this.children.length === 0 && this.running.length === 0) {\n\t\t\tif (this.stopHandler === RunQueue.StopHandlerAuto || this.stopHandler === RunQueue.StopHandlerAutoAtLeastOnce || this.toStop) {\n\t\t\t\tthis.toStop = true;\n\t\t\t\tthis.done();\n\t\t\t}\n\t\t}\n\t}\n\tprivate done() {\n\t\tif (this.e && this.errHandler !== ErrHandler.Ignore) {\n\t\t\tthis.getRP().reject(this.e);\n\t\t} else {\n\t\t\tthis.getRP().resolve();\n\t\t}\n\t}\n\tprotected async doStop(context: any) {\n\t\tthis.toStop = true;\n\t\tlet all = [];\n\t\tfor (const action of this.running) all.push(action.stop(context));\n\t\tthis.running.length = 0;\n\t\tfor (const action of this.children) all.push(action.stop(context));\n\t\tthis.children.length = 0;\n\t\tawait Promise.all(all);\n\t}\n\n\t//\n\tpublic addOne(a: Action) {\n\t\treturn this.addChild(a);\n\t}\n\tpublic async doOne(a: Action) {\n\t\tif ((this.isIdle() || this.isPending()) && !this.toStop) {\n\t\t\tsuper.addChild(a);\n\t\t\t//\n\t\t\tlet p = new Promise((resolve) => a.watch(resolve));\n\t\t\tif (this.isPending()) this.next();\n\t\t\tawait p;\n\t\t}\n\t\treturn a;\n\t}\n\tpublic async stopOne(a: string | Action) {\n\t\tfor (let i = 0; i < this.running.length; i++) {\n\t\t\tconst action = this.running[i];\n\t\t\tif (typeof a === 'string' && a !== action.getName()) continue;\n\t\t\telse if (a !== action) continue;\n\t\t\t//\n\t\t\tthis.running.splice(i, 1);\n\t\t\tawait action.stop(this.context);\n\t\t\tthis.next();\n\t\t\treturn;\n\t\t}\n\t\tfor (let i = 0; i < this.children.length; i++) {\n\t\t\tconst action = this.running[i];\n\t\t\tif (typeof a === 'string' && a !== action.getName()) continue;\n\t\t\telse if (a !== action) continue;\n\t\t\t//\n\t\t\tthis.children.splice(i, 1);\n\t\t\tawait action.stop(this.context);\n\t\t\treturn;\n\t\t}\n\t}\n\t//\n\tpublic addBatch(as: Action[]) {\n\t\tfor (let a of as) this.addChild(a);\n\t\treturn this;\n\t}\n\tpublic async doBatch(as: Action[], errHandler: number = ErrHandler.Ignore) {\n\t\tlet all = [];\n\t\tfor (let a of as) all.push(this.doOne(a));\n\t\tawait Promise.all(all);\n\t\t//\n\t\tif (errHandler != ErrHandler.Ignore) {\n\t\t\tfor (let a of as) {\n\t\t\t\tif (a.isRejected()) return a.getError();\n\t\t\t}\n\t\t}\n\t}\n\tpublic async stopBatch(as: Action[]) {\n\t\tlet all = [];\n\t\tfor (let a of as) all.push(this.stopOne(a));\n\t\tawait Promise.all(all);\n\t}\n}\n","import { Action, CompositeAction } from './action';\nimport { ActionForFunc, IFunc } from './action-func';\nimport { RunQueue } from './run-queue';\nimport { ErrHandler } from './utils';\n\nexport interface IRange {\n\tfrom: number;\n\tto: number;\n\tcount: number;\n}\nexport type IHandlerFactory = (context: any, i: number, range: IRange, caller: RunStep) => Action | IFunc | Promise<Action | IFunc>;\nexport type IOnStep = (context: any, range: IRange, caller: RunStep) => Promise<any>;\n\nexport class RunStep extends CompositeAction {\n\tprotected from: number;\n\tprotected step: number;\n\tprotected limit: number;\n\tprotected to: number;\n\tprotected onBeforeStep: IOnStep;\n\tprotected handlerFactory: IHandlerFactory;\n\tprotected onAfterStep: IOnStep;\n\t//\n\tprotected queueAction!: RunQueue;\n\tprotected queueName: string;\n\tprotected toStop: boolean = false;\n\n\tconstructor(\n\t\tfrom: number = 0,\n\t\tstep: number = 0,\n\t\tlimit: number = 0,\n\t\tto: number = 0,\n\t\tonBeforeStep?: IOnStep,\n\t\thandlerFactory?: IHandlerFactory,\n\t\tonAfterStep?: IOnStep,\n\t\terrHandler: number = ErrHandler.RejectAllDone\n\t) {\n\t\tsuper(errHandler);\n\t\tthis.from = from;\n\t\tthis.step = step;\n\t\tthis.limit = limit;\n\t\tthis.to = to;\n\t\tthis.onBeforeStep = onBeforeStep;\n\t\tthis.handlerFactory = handlerFactory;\n\t\tthis.onAfterStep = onAfterStep;\n\t}\n\tpublic setValues(from: number = 0, step: number = 0, limit: number = 0, to: number = 0) {\n\t\tthis.from = from;\n\t\tthis.step = step;\n\t\tthis.limit = limit;\n\t\tthis.to = to;\n\t\treturn this;\n\t}\n\tpublic setOnBeforeStep(fn: IOnStep) {\n\t\tthis.onBeforeStep = fn;\n\t\treturn this;\n\t}\n\tpublic setHandlerFactory(fn: IHandlerFactory) {\n\t\tthis.handlerFactory = fn;\n\t\treturn this;\n\t}\n\tpublic setOnAfterStep(fn: IOnStep) {\n\t\tthis.onAfterStep = fn;\n\t\treturn this;\n\t}\n\tpublic setQueueName(name: string) {\n\t\tthis.queueName = name;\n\t\treturn this;\n\t}\n\tpublic setToStop() {\n\t\tthis.toStop = true;\n\t\treturn this;\n\t}\n\tpublic extendLimit(limit: number) {\n\t\tif (limit > this.limit) this.limit = limit;\n\t\treturn this.limit;\n\t}\n\tpublic extendTo(to: number) {\n\t\tif (to > this.to) this.to = to;\n\t\treturn this.to;\n\t}\n\t//\n\tpublic addChild(a: Action) {\n\t\tif (this.queueAction && !this.toStop) this.queueAction.addChild(a);\n\t\treturn this;\n\t}\n\tpublic numChildren() {\n\t\treturn this.queueAction ? this.queueAction.numChildren() : 0;\n\t}\n\t//\n\tprotected async doStart(context: any) {\n\t\tlet count = 0;\n\t\tlet e: Error;\n\t\tlet current = this.from;\n\t\twhile (current <= this.to) {\n\t\t\tthis.toStop = false;\n\t\t\t//1,3,5,10\n\t\t\tconst range: IRange = { from: current, to: this.to, count };\n\t\t\t//截断\n\t\t\tif (this.step > 0) {\n\t\t\t\trange.to = Math.min(current + this.step - 1, this.to);\n\t\t\t}\n\t\t\t//截断\n\t\t\tif (this.limit > 0 && this.limit - count < range.to - range.from + 1) {\n\t\t\t\trange.to = range.from + (this.limit - count) - 1;\n\t\t\t}\n\n\t\t\t// before\n\t\t\tif (this.onBeforeStep) await this.onBeforeStep(context, range, this);\n\t\t\tif (!this.isPending()) break;\n\t\t\tif (this.toStop) {\n\t\t\t\tif (this.onAfterStep) await this.onAfterStep(context, range, this);\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\t// pending\n\t\t\trange.count = count = count + (range.to - range.from + 1);\n\t\t\t//\n\t\t\tthis.queueAction = new RunQueue(0, RunQueue.StopHandlerAuto, this.errHandler);\n\t\t\t(this.queueAction as any).parent = this;\n\t\t\tif (this.queueName) this.queueAction.setName(this.queueName);\n\t\t\tfor (let i = range.from; i <= range.to; i++) {\n\t\t\t\tlet result = this.handlerFactory(context, i, range, this);\n\t\t\t\tlet af: Action | IFunc;\n\t\t\t\tlet a: Action;\n\t\t\t\t//\n\t\t\t\tif (result instanceof Promise) af = await result;\n\t\t\t\telse af = result;\n\t\t\t\tif (af instanceof Action) a = result as Action;\n\t\t\t\telse a = new ActionForFunc(af);\n\t\t\t\t//\n\t\t\t\tthis.queueAction.addChild(a);\n\t\t\t\t// console.log(i, options);\n\t\t\t\t// if (this.limit > 0 && count >= this.limit) { options.to = i; break; }\n\t\t\t}\n\t\t\tawait this.queueAction.start(context);\n\t\t\t//\n\t\t\tif (!this.isPending()) break;\n\t\t\tif (this.queueAction.isRejected()) {\n\t\t\t\tif (!e) e = this.queueAction.getError();\n\t\t\t\tif (this.errHandler === ErrHandler.RejectImmediately) throw e;\n\t\t\t}\n\t\t\tthis.queueAction = undefined;\n\n\t\t\t// after\n\t\t\tif (this.onAfterStep) await this.onAfterStep(context, range, this);\n\t\t\tif (!this.isPending()) break;\n\t\t\tif (this.toStop) break;\n\t\t\tif (this.limit > 0 && count >= this.limit) break;\n\t\t\t//\n\t\t\tcurrent = range.to + 1;\n\t\t\tif (current > this.to) break;\n\t\t}\n\t\t// console.log(\"done\");\n\t\tif (e && this.errHandler !== ErrHandler.Ignore) throw e;\n\t}\n\n\tprotected async doStop(context: any) {\n\t\tif (this.queueAction) await this.queueAction.stop(context);\n\t\tawait super.doStop(context);\n\t}\n}\n"],"names":[],"mappings":"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"}